---
description: Vault and Consul Server template
variables:
  gce_account_file: "{{ env `GCE_ACCOUNT_FILE` }}"
  gce_project_id: "{{ env `GCE_PROJECT_ID` }}"
  consul_version: 1.21.3
  consul_sha: ba20631037a5f63f70b0351c0875887a66c0a0d3feac2d255a768c9eb8c95e8b
  vault_version: 1.20.2
  vault_sha: 5846abf08deaf04cc9fdbb7c1eddda3348671590445f81bcdb0a2e0d32396c2e
builders:
- type: googlecompute
  account_file: "{{ user `gce_account_file` }}"
  project_id: "{{ user `gce_project_id` }}"
  source_image: ubuntu-1604-xenial-v20170619a
  zone: us-central1-b
  image_name: vault-consul-{{ timestamp }}-<%= git_desc %>
  machine_type: g1-small
  ssh_username: ubuntu
  tags:
  - vault
provisioners:
- type: shell
  scripts:
  - packer-scripts/consul-install
  - packer-scripts/vault-install
  environment_vars:
  - CONSUL_VERSION={{ user `consul_version` }}
  - CONSUL_SHA={{ user `consul_sha` }}
  - VAULT_VERSION={{ user `vault_version` }}
  - VAULT_SHA={{ user `vault_sha` }}
  execute_command: "{{ .Vars }} exec sudo -E -S bash '{{ .Path }}'"
